# Blossom School Catering

Creation date: 2026-02-24
GitHub remote name: `origin` (`git@github.com-net1io:Gaia-Digital-Agency/blossom_schoolcatering.git`)
Developed by Gaiada.com
Copyright (C) 2026

## App Title
Blossom School Catering

## App Introduction
Blossom School Catering is a mobile-first food ordering web application for international school catering in Bali, powered by Blossom Steakhouse kitchen.
The app enables parents and children to place school meal orders (Lunch, Snack, Breakfast) via a cart/basket flow, while kitchen and admin users manage operations, reporting, and menu updates.

## Business Goals
- Enable simple, fast, cart-based meal ordering for families.
- Support multi-school / multi-campus management with per-school academic year configuration.
- Support parent-to-multiple-child management (up to 10 children per parent); each child registered separately.
- Provide quick reorder, meal plan wizard, and favourite meals for returning users.
- Ensure kitchen gets reliable order summaries, allergen alerts, and printable tags with QR codes.
- Provide billing visibility with proof-of-payment upload and digital PDF receipts.
- Engage children with a Clean Plate Club gamification system (streak and completion badges).
- Go live by 1 April 2026 with required test completion.

## Functional Scope Summary
- Roles: Parent, Child, Admin, Kitchen, Delivery.
- Sessions: Lunch, Snack, Breakfast (display order: Lunch → Snack → Breakfast).
- Cart flow: users build a cart before confirming an order; cart expires at 08:00 AM on service date.
- Order rule: one meal set per child per session per day (max 3 sessions/day, max 5 items/order or cart).
- Child permissions: create own order only; cannot edit/delete after placement.
- Parent permissions: order per child, edit/delete before 08:00 same day; quick reorder; meal plan wizard.
- Parent uses one login to manage all linked children, with separate child pages and a consolidated parent summary.
- Weekday service rule: meals are for Monday–Friday; blackout dates also enforced.
- Schools: multi-school/campus support via schools master table; children linked by FK.
- Academic years/terms: configurable per school; service dates outside active terms show a soft warning.
- Admin manages master ingredient list; each menu item selects from this list; menu search and filter available.
- Menu scale: 20–50 items per session category.
- Ingredient restrictions per child, snapshotted on each order for kitchen use.
- Kitchen allergen alert dashboard highlights orders with dietary restriction conflicts.
- Delivery role confirms delivered orders; billing delivery status updated automatically.
- Clean Plate Club: streak and completion badges awarded server-side on each order placement.
- Dark mode, onboarding flow, and tooltip preferences stored per user.
- Digital PDF receipts generated by admin on payment verification.
- Google Account sign-in supported (OAuth) for parent and child users.
- Username collision handling: auto-append suffix (`-1`, `-2`, ...) when generated username already exists.

## App Architecture

### 1) Client Layer (Mobile-first Web)
- Next.js (TypeScript) frontend.
- Tailwind CSS with dark mode support (dark class strategy).
- Responsive dashboards for: Parent, Child, Admin, Kitchen, Delivery.
- Session colour-coding: Lunch = amber, Snack = lime, Breakfast = sky blue.
- Micro-animations: fade/slide transitions, success confetti on order confirm, skeleton screens for loading.
- Progress stepper for billing: UNPAID → PENDING VERIFICATION → VERIFIED; secondary bar for delivery status.
- Kitchen dashboard: polling-based updates every 30–60 seconds with manual Refresh button.

### 2) API/Application Layer
- NestJS (TypeScript) service layer.
- JWT-based authentication and role-based authorisation with refresh token rotation.
- Event-driven domain events (NestJS EventEmitter) for order lifecycle, billing, and badge calculation.
- REST JSON APIs as primary interface; OpenAPI/Swagger auto-generated from NestJS decorators.
- Correlation ID middleware for end-to-end request tracing.
- Rate limiting via NestJS ThrottlerModule.
- Optional GraphQL read endpoints for analytics expansion later.

### 3) Data Layer
- PostgreSQL as source of truth (primary write + analytics read replica).
- Redis for JWT refresh token store, cart expiry keys, visitor counter.
- GCS + Cloud CDN for all assets: menu images, payment proof images, PDF receipts.

### 4) Ops/Infra Layer
- GCP VM staging target (`gda-s01`).
- Nginx reverse proxy.
- Firewall-controlled ingress.
- Load balancer and CDN ready topology for scale-up.
- pg_cron for scheduled materialized view refresh (every 5 minutes).
- Structured JSON logging (Winston) with correlation ID per request.
- Backups, logs, and monitoring.

## App Language and Frameworks
- Frontend: TypeScript, Next.js, Tailwind CSS
- Backend: TypeScript, NestJS
- Database: PostgreSQL (primary + read replica)
- Cache/Sessions: Redis
- Storage: Google Cloud Storage + Cloud CDN
- Auth: JWT with refresh token rotation (Redis-backed invalidation)
- Google OAuth 2.0 for social sign-in (mapped to internal JWT session)
- API styles:
  - REST (JSON) — primary
  - GraphQL — optional for selected analytics endpoints
  - gRPC — optional for future internal service expansion

## New Features (beyond v0 baseline)
- **Cart/Basket flow** — draft staging area before order confirmation; expires at 08:00 cutoff
- **Quick Reorder** — pre-fill cart from any prior order with one tap
- **Meal Plan Wizard** — multi-step bulk ordering across a date range
- **Smart Cutoff Countdown** — visible timer on all cart pages; disables actions at zero
- **Menu Search & Filter** — keyword search, allergen filter, price range, favourites filter
- **Guided Onboarding Flow** — first-login wizard for new parents
- **Tooltips & Contextual Help** — per-field help icons; toggle in preferences
- **Favourite Meals** — save and reapply meal combos (max 20 per user)
- **Nutritional Summary** — weekly per-child nutrition overview
- **Birthday Meal Highlights** — visual indicator on kitchen view and order tags
- **Clean Plate Club Badges** — streak and completion badges awarded server-side on order placement
- **Allergen Alert Dashboard** — kitchen/admin view of orders with dietary restriction conflicts
- **Spending Dashboard** — parent: monthly spend, outstanding balance, top meals, trend chart
- **Revenue Dashboard** — admin: revenue by day/week/month, school, session, payment status
- **Multi-School / Multi-Campus** — schools master table; children linked via FK
- **Academic Year/Term Config** — per-school; soft warning for service dates outside active terms
- **Digital Receipts** — PDF generation on payment verification; stored in GCS; downloadable by parent
- **CSV Bulk Import** — admin bulk upload parents and children with per-row validation report
- **Registration Page** — public parent self-registration; each child registered separately by parent
- **Color-Coded Sessions** — amber/lime/sky blue visual identity per session
- **Micro-Animations** — transitions, skeleton screens, success animation, shake on validation error
- **Dark Mode** — per-user preference; respects OS prefers-color-scheme on first load
- **Progress Stepper for Billing** — visual UNPAID → VERIFIED flow + delivery status bar
- **Event-Driven Pipeline** — NestJS EventEmitter for order/billing/badge domain events

## Frontend Features Presence
- UI/UX: luxury Blossom-inspired direction; dark mode; colour-coded sessions; micro-animations; child/parent-friendly flows
- Mobile View Friendly: mobile-first layout (min 375px); all pages functional on mobile
- JWT Auth: role-aware login and session handling with refresh token rotation
- APIs: REST API integration with typed contracts; OpenAPI docs at `/api/v1/docs`
- SEO: public homepage metadata, semantic HTML, indexable content for non-auth pages

## System Design Elements Presence
- Application: multi-role, multi-school meal ordering platform
- Framework: Next.js + NestJS
- Database: PostgreSQL (primary + read replica)
- Firewall: network ACL / security groups for controlled access
- Load Balancers: supported for production rollout
- CDN Server: GCS + Cloud CDN for all static and media assets
- Caching: Redis (JWT tokens, cart expiry keys, short-lived counters)
- Networking notes:
  - IP/TCP foundation for transport
  - TCP carries HTTP; WebSocket deferred to future version
  - Request path model: Port → IP → DNS
- API patterns:
  - REST JSON (primary)
  - GraphQL (optional analytics)
  - gRPC (optional internal)

## Core Module Design
- Identity and Access: roles; username conventions; public registration page; CSV bulk import
- User Preferences: dark mode, onboarding state, tooltips toggle per user
- Schools and Academic Config: schools master table; academic years and terms per school
- Family and Child Profiles: parent-child mapping (max 10); school FK; dietary restrictions
- Cart and Ordering: cart/basket flow; quick reorder; meal plan wizard; cutoff countdown; order duplication
- Favourite Meals: save/apply meal combos; pre-fill carts (max 20 per user)
- Menu Management: admin CRUD; session/date binding; nutrition and ingredient data; search & filter
- Billing and Payment Proof: proof upload; verify/reject; digital receipt PDF generation
- Kitchen Operations: polling-based summary; allergen alert dashboard; print reports; print order tags with QR codes
- Delivery Operations: assigned daily deliveries; confirm delivery; billing status sync
- Analytics: revenue dashboard (admin); spending dashboard (parent); kitchen analytics; nutritional summary
- Gamification: Clean Plate Club badges; streak tracking; birthday highlights on kitchen view

## Proposed File Structure
```text
blossom-schoolcatering/
  README.md
  requirements.md
  schema.md
  docs/
    specs/
      data-model.md
      api-contract.md
      order-rules.md
      rbac-matrix.md
    architecture/
    testing/
  db/
    migrations/
      001_init_schema.sql
      002_seed_reference_data.sql
      003_views_and_reports.sql
  apps/
    web/                  # Next.js frontend
    api/                  # NestJS backend
  packages/
    ui/                   # shared UI components
    config/               # ts/eslint/prettier/shared settings
    types/                # shared DTO/types
  infra/
    nginx/
    gcp/
    scripts/
  .github/
    workflows/
```

## Compile Steps
```bash
# 1) Install dependencies
npm install

# 2) Build all apps/packages
npm run build
```

## Run Steps
```bash
# 1) Start local services (postgres, redis via docker compose or local)

# 2) Run database migrations
psql $DATABASE_URL -f db/migrations/001_init_schema.sql
psql $DATABASE_URL -f db/migrations/002_seed_reference_data.sql
psql $DATABASE_URL -f db/migrations/003_views_and_reports.sql

# 3) Start backend API
npm run dev:api

# 4) Start frontend web
npm run dev:web

# 5) Open local app
# http://localhost:3000

# 6) API docs (Swagger/OpenAPI)
# http://localhost:3001/api/v1/docs
```

## Environment and Deployment Notes
- Staging VM: `gda-s01`
- Staging path: `/var/www/schoolcatering`
- Staging URL: `http://34.124.244.233/schoolcatering`
- Bucket: `gda-ce01` / folder `blossom_schoolcatering`
- CDN base: `https://cdn.gda-ce01.storage/blossom_schoolcatering/`
- SSH: `ssh -i ~/.ssh/gda-ce01 azlan@34.124.244.233`

## Suggested Testing
- Unit Testing: validators, business rules, auth, pricing, badge logic, cart expiry
- Integration Testing: API + DB flows for auth/schools/menus/carts/orders/billing/receipts
- System Testing: end-to-end flows per role (parent/child/admin/kitchen/delivery)
- User Testing (UAT): school operations simulation, parent ordering, cart flow, kitchen print workflows
- Regression Testing: cutoff times, weekday service, blackout enforcement, cart expiry, badge calculation
- Security Testing: JWT rotation, upload validation, RBAC boundaries, rate limiting
- Performance Testing: peak-hour ordering, kitchen polling load, analytics read-replica queries

## Quality Gates Before Go-Live (1 April 2026)
- All critical and high defects closed.
- Required tests completed and signed off: Unit, Integration, System, User Testing.
- Data backup/restore checks passed.
- Monitoring and alerting baseline active.
- pg_cron scheduled jobs verified (materialized view refresh every 5 minutes).
- CDN cache configuration verified for all media assets.

## Additional Notes
- Footer requirement in app:
  - Copyright (C) 2026
  - Developed by Gaiada.com
  - Visitor count (starting at 35), location, and time
- Privacy requirement: strict privacy and confidentiality page must be included.
- App language: English only (no i18n / multi-language support in v1).
